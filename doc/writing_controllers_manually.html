<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#" class="no-js">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Writing controllers | Splash router</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="apple-touch-icon" sizes="57x57" href="/dist/img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/dist/img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/dist/img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/dist/img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/dist/img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/dist/img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/dist/img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/dist/img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/dist/img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/dist/img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/dist/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/dist/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/dist/img/favicon/favicon-16x16.png">

    <link href="//fonts.googleapis.com/css?family=Roboto:400,700,300,500" rel="stylesheet" type="text/css">

    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/dist/img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="msapplication-TileColor" content="#f01d4f">
    <meta name="msapplication-TileImage" content="//www.thecodingmachine.com/wp-content/themes/thecodingmachine/library/images/win8-tile-icon.png">

    <script>
        window.resourceBaseUrl = 'https://thecodingmachine.github.io/splash-router';
    </script>

    <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }
    </style>

    <link rel="stylesheet" type="text/css" href="https://thecodingmachine.github.io/splash-router/assets/main.css">
                

    <link rel='stylesheet' id='font-awesome-css'  href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css' type='text/css' media='all' />
    <link rel='stylesheet' id='google-roboto-css'  href='//fonts.googleapis.com/css?family=Roboto%3A100%2C400%2C300%2C400italic%2C500%2C700' type='text/css' media='all' />

    <style>
        pre.hljs {padding: 5px;}
        pre.hljs code {}
            </style>
        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-10196481-4', 'auto');
        ga('send', 'pageview');

    </script>
    </head>
<body class="">

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div >
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <img class="img-responsive" src="https://thecodingmachine.github.io/splash-router/doc/images/logo.png" alt="" style="position: absolute;">
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav text-left">
                <li><a href="https://thecodingmachine.github.io/splash-router/">ABOUT</a></li>
                                                            <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/index.html">
                                Introduction
                            </a>
                        </li>
                                                                                                                    <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/install/index.html">
                                Installing Splash
                            </a>
                        </li>
                                                                                <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/install/mouf.html">
                                Install in Mouf
                            </a>
                        </li>
                                                                                <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/install/standalone.html">
                                Install using Service providers
                            </a>
                        </li>
                                                                                                                    <li class="active visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/writing_controllers_manually.html">
                                Writing controllers
                            </a>
                        </li>
                                                                                                                    <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/mouf_integration/writing_controllers.html">
                                Controller creation wizard
                            </a>
                        </li>
                                                                                <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/mouf_integration/url_routing.html">
                                Advanced: configuring routing
                            </a>
                        </li>
                                                                                                                    <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/url_parameters.html">
                                Managing URL parameters
                            </a>
                        </li>
                                                                                <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/filters.html">
                                Writing your own filters
                            </a>
                        </li>
                                                                                <li class=" visible-xs-block">
                            <a href="https://thecodingmachine.github.io/splash-router/doc/migrating.html">
                                Migrating from older version
                            </a>
                        </li>
                                                    <li><a href="http://www.thecodingmachine.com/">TheCodingMachine</a></li>
                                <li><a href="https://github.com/thecodingmachine/splash-router"><img src="https://thecodingmachine.github.io/splash-router/img/GitHub-Mark-Light-20px.png" /> Github</a></li>
                            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Full Width Image Header with Logo -->
<!-- Image backgrounds are set within the full-width-pics.css file. -->
<div id="wrapper">
    <a href="#menu-toggle" class="burger-position" id="menu-toggle" ><img src="https://thecodingmachine.github.io/splash-router/doc/images/hamburger.png"> </a>
    <!-- Sidebar -->
    <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/index.html">
                            Introduction
                        </a>
                    </li>
                                                                <li>
                        <h4>Installation</h4>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/install/index.html">
                            Installing Splash
                        </a>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/install/mouf.html">
                            Install in Mouf
                        </a>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/install/standalone.html">
                            Install using Service providers
                        </a>
                    </li>
                                                                <li>
                        <h4>Basics</h4>
                    </li>
                                                                <li class="active">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/writing_controllers_manually.html">
                            Writing controllers
                        </a>
                    </li>
                                                                <li>
                        <h4>Integrations - Mouf</h4>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/mouf_integration/writing_controllers.html">
                            Controller creation wizard
                        </a>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/mouf_integration/url_routing.html">
                            Advanced: configuring routing
                        </a>
                    </li>
                                                                <li>
                        <h4>Advanced</h4>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/url_parameters.html">
                            Managing URL parameters
                        </a>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/filters.html">
                            Writing your own filters
                        </a>
                    </li>
                                                                <li class="">
                        <a href="https://thecodingmachine.github.io/splash-router/doc/migrating.html">
                            Migrating from older version
                        </a>
                    </li>
                                    </ul>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <header class="image-bg-fluid-height skew">
            <div class="wrapper content">
                <!-- /
              <h4 class="glitch">DISCOVERY</h4>
               -->
            </div>

        </header>
        <div class="container pt100">
            <div class="row">
                <div class="col-xs-12">
                    <h1>Writing controllers <small></small></h1>                    <p>In this document, we will see how to create a controller.
You will also learn more about what makes a controller.</p>
<p>Note: if you are using <em>Mouf</em>, Splash comes with a <a href="writing_controllers.html">controller creation wizard (a nice user interface)</a>.</p>
<h2 id="what-is-a-controller">What is a controller?</h2>
<p>In Splash, a controller is a class that contains a number of <em>Actions</em>.
<em>Actions</em> are methods that can be directly accessed from the browser.</p>
<p>There are several ways to declare a method to be an action. The most common ways are:</p>
<ul>
<li>The <em>@URL</em> annotation</li>
<li>The <em>@Action</em> annotation</li>
</ul>
<h2 id="the-url-annotation">The @URL annotation</h2>
<p>This is the preferred way of declaring an action:</p>
<pre><code class="language-php">&lt;?php
namespace Test\Controllers;

use TheCodingMachine\Splash\Annotations\URL;
use Psr\Http\Message\ResponseInterface;

class MyController {

    /**
     * My first action.
     *
     * @URL("/path/to/my/action")
     * @param string $var1
     * @param string $var2
     */
    public function myUrl(string $var1, string $var2): ResponseInterface {
        $str = "&lt;html&gt;&lt;head&gt;&lt;/head&gt;";
        $str .= "&lt;body&gt;";
        $str .= "var1 value is ".htmlentities($var1)." and var2 value is ".htmlentities($var2);
        $str .= "&lt;/body&gt;";
        return new HtmlResponse($str);
    }
}</code></pre>
<p>Note: this class must be auto-loadable by Composer. Be sure to put the class in the correct repository according to your <em>composer.json</em> <code>autoload</code> section.</p>
<p>The <em>@URL</em> annotation points to the web path the action is bound to.</p>
<p>The action takes 2 parameters: <code>$var1</code> and <code>$var2</code>. This means that the page needs both parameters passed
either in GET or POST.</p>
<p>In order to test this, we must first create an instance of the controller in your container.
How you do this really depends on the container you are using. See the <a href="install/index.html">installation section for more information</a>.</p>
<p>Finally, we must also register this controller in Splash. How this is done essentially depends on your Splash installation.</p>
<ul>
<li>if you are using Mouf, you have nothing to do. Splash will automatically detect your controllers.</li>
<li>
<p>if you are using Splash service provider, you need to put in your container an entry named 'thecodingmachine.splash.controllers' that is an array of controller identifiers.
The way to do this depends on the container you are using, but might be something similar to:</p>
<pre><code class="language-php">$container-&gt;set('thecodingmachine.splash.controllers', [
   'myController',
   'myOtherController',
]);</code></pre>
</li>
</ul>
<p>Now, let's test our code.
By browsing to <code>http://localhost/{my_app}/path/to/my/action?var1=42&amp;var2=24</code>, we should see the message displayed!</p>
<p><em>Troubleshooting:</em> If for some reason, your controller is not detected, you can try to purge your cache.</p>
<p>Done? Then let's move on! </p>
<h2 id="the-get--post-annotations">The @Get / @Post annotations</h2>
<p>We might decide that an action should always be called via GET, or via POST (or PUT or DELETE if you want to provide REST services).
Splash makes that very easy to handle. You can just add a @Get or @Post annotation (or @Put or @Delete). Here is a sample:</p>
<pre><code class="language-php">&lt;?php
namespace Test\Controllers;

use TheCodingMachine\Splash\Annotations\URL;
use TheCodingMachine\Splash\Annotations\Get;
use TheCodingMachine\Splash\Annotations\Post;

/**
 * This is a sample user controller.
 *
 */
class UserController {

    /**
     * Viewing the user is performed by a @Get.
     *
     * @URL("/user")
     * @Get
     * @param string $id
     */
    public function viewUser(string $id): ResponseInterface {
        return new HtmlResponse("Here, we might put the form for user ".htmlentities($id));
    }

    /**
     * Modifying the user is performed by a @Post.
     *
     * @URL("/user")
     * @Post
     * @param string $id
     * @param string $name
     * @param string $email
     */
    public function editUser(string $id, string $name, string $email): ResponseInterface {
         return new HtmlResponse("Here, we might put the code to change the user object.");
    }

}</code></pre>
<p>In the example above (a sample controller to view/modify users), the &quot;/user&quot; URL is bound to 2 different methods
based in the HTTP method used to access this URL.</p>
<h2 id="parametrized-urls">Parametrized URLs</h2>
<p>You can put parameters in the URLs and fetch them very easily:</p>
<pre><code class="language-php">&lt;?php
/**
 * This is a sample user controller.
 *
 */
class UserController {

    /**
     * Viewing the user is performed by a @Get.
     *
     * @URL("/user/{id}/view")
     * @Get
     * @param string $id
     */
    public function viewUser(string $id): ResponseInterface {
         return new HtmlResponse("Here, we might put the form for user ".htmlentities($id));
    }
}
?&gt;</code></pre>
<p>Do you see the @URL annotation? The {id} part is a placeholder that will be replaced by any value found in the URL.
So for instance, if you access <a href="http://[server]/[appname]/user/42/view">http://[server]/[appname]/user/42/view</a>, the $id parameter will be filled with &quot;42&quot;.</p>
<h2 id="returning--outputting-values">Returning / outputting values</h2>
<p>As you probably already guessed, you must return a <a href="http://www.php-fig.org/psr/psr-7/#3-3-psr-http-message-responseinterface">PSR-7 Response object</a>.
Splash comes bundled with <a href="https://github.com/zendframework/zend-diactoros">Zend Diactoros</a></p>
<p>Therefore, you can write things like:</p>
<pre><code class="language-php">&lt;?php
use TheCodingMachine\Splash\Annotations\URL;
use Zend\Diactoros\Response\HtmlResponse;
use Zend\Diactoros\Response\JsonResponse;

class MyController {

    /**
     * Returning a Response object
     *
     * @URL("/myurl1")
     */
    public function test1(): ResponseInterface {
         return new HtmlResponse('Hello World', 200, array('content-type' =&gt; 'text/html'));
    }

    /**
     * Returning a JSON response
     *
     * @URL("/myjsonurl")
     */
    public function testJson(): ResponseInterface {
         return new JsonResponse({ "status" =&gt; "ok", "message" =&gt; "Hello world!" });
    }
}
?&gt;</code></pre>
<p>Typically, in Mouf, you will want to output a template object. You can easily output templates (or any object
implementing the <a href="http://mouf-php.com/packages/mouf/html.htmlelement/index.html"><code>HtmlElementInterface</code></a> using the <code>HtmlResponse</code> object:</p>
<pre><code class="language-php">&lt;?php
use TheCodingMachine\Splash\Annotations\URL;
use TheCodingMachine\Splash\HtmlResponse;

class MyController {
    /**
     * @var HtmlElementInterface
     */
    private $template;

    ...

    /**
     * Returning a Response object
     *
     * @URL("/test_template")
     */
    public function test1(): ResponseInterface {
        // do stuff
        return new HtmlResponse($this-&gt;template);
    }
}</code></pre>
<h2 id="uploading-files">Uploading files</h2>
<p>Uploaded files are also directly available from the signature of the method:</p>
<p><strong>HTML:</strong></p>
<pre><code class="language-html">&lt;input type="file" name="avatar" /&gt;</code></pre>
<p><strong>PHP</strong>:</p>
<pre><code class="language-php">&lt;?php
use TheCodingMachine\Splash\Annotations\URL;
use Psr\Http\Message\UploadedFileInterface;

class MyController {

    ...

    /**
     * Uploads a file
     *
     * @URL("/upload")
     */
    public function uploadLogo(UploadedFileInterface $logo): ResponseInterface {
        $logo-&gt;moveTo(__DIR__.'/uploads/logo.png');
        // ...
    }
}</code></pre>
<p>The <code>$logo</code> object injected implements the <a href="http://www.php-fig.org/psr/psr-7/#3-6-psr-http-message-uploadedfileinterface">PSR-7 <code>UploadedFileInterface</code></a></p>
<h2 id="the-action-annotation">The @Action annotation</h2>
<p>The @Action parameter can replace the @URL parameter.
You simply put a @Action annotation in your method. The URLs to access a @Action method are always:</p>
<pre><code>http://[server-url]/[webapp-path]/[controller-instance-name]/[action-name]</code></pre>
<p>Here is a sample:</p>
<pre><code class="language-php">&lt;?php
use TheCodingMachine\Splash\Annotations\Action;

/**
 * This is my test controller.
 *
 */
class MyController {

    /**
     * My first action.
     *
     * @Action
     * @param string $var1
     * @param string $var2
     */
    public function my_action(string $var1, string $var2): ResponseInterface {
        return new HtmlResponse("Hello!");
    }
}
?&gt;</code></pre>
<p>The <em>my_action</em> method is a Splash action. You know this because there is a @Action annotation in the PHPDoc comment of the method.</p>
<p>Now, we can access the example page using this URL:</p>
<pre><code>http://[server-url]/[webapp-path]/my_controller/my_action?var1=42&amp;var2=toto</code></pre>
<h2 id="default-actions">Default actions</h2>
<p>Sometimes, when using @Action annotations, we might want to have a URL that is a bit shorter than /my_webapp/my_controller/my_action.
Splash supports a special method called &quot;index&quot;. If no action is provided in the URL, the index method will be called instead.</p>
<pre><code class="language-php">&lt;?php
/**
 * This is my test controller.
 */
class MyController extends Controller {

    /**
     * The action called if no action is provided in the URL.
     *
     * @Action
     */
    public function index(): ResponseInterface {
        return new HtmlResponse("This is the index");
    }
}
?&gt;</code></pre>
<p>The test page can be accessed using the URL:</p>
<pre><code>http://[server-url]/[webapp-path]/my_controller/.</code></pre>
<p><a href="mouf_integration/writing_controllers.html">Wanna learn more? Have a look at the Mouf controller cration wizard</a></p>

                    <p class="fork-and-edit">
                        Found a typo? Something is wrong in this documentation? Just
                        <a href="https://github.com/thecodingmachine/splash-router/blob/master/doc/writing_controllers_manually.md">fork and edit it</a>!
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- /#page-content-wrapper -->

</div>
<div class="footer">
    <div class="container-fluid">
        <footer class="row" id="footer">
            <div class="col-xs-12">
                Made with <span class="pulse2 glyphicon glyphicon-heart" style="color: red" aria-hidden="true"></span><span class="sr-only">love</span> by <a href="https://www.thecodingmachine.com/"><img src="https://thecodingmachine.github.io/splash-router/img/logo.png" alt="TheCodingMachine"></a> for all open-source lovers
                <span class="copyright">&copy; 2016 - 2018 <a href="https://www.thecodingmachine.com/">TheCodingMachine</a> - All Rights Reserved</span>
                Powered by <a href="http://couscous.io/">Couscous</a></span>
            </div>
        </footer>
    </div>
</div>

<!-- /#wrapper -->
<script type='text/javascript' src='https://thecodingmachine.github.io/splash-router/assets/app.bundle.js'></script>
<script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
</script>
</body>
</html>
